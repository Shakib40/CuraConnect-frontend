{"ast":null,"code":"import axios from \"axios\";\nconst axiosInstance = axios.create({\n  baseURL: \"http://localhost:8080/api\",\n  headers: {\n    \"Content-Type\": \"application/json\"\n  }\n});\n\n// ðŸ”¹ Attach Access Token\naxiosInstance.interceptors.request.use(config => {\n  const token = sessionStorage.getItem(\"token\");\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n}, error => Promise.reject(error));\n\n// ðŸ”¥ Refresh Control Variables\nlet isRefreshing = false;\nlet failedQueue = [];\n\n// Process waiting requests\nconst processQueue = (error, token = null) => {\n  failedQueue.forEach(prom => {\n    if (error) {\n      prom.reject(error);\n    } else {\n      prom.resolve(token);\n    }\n  });\n  failedQueue = [];\n};\n\n// ðŸ”¹ Response Interceptor\naxiosInstance.interceptors.response.use(response => response, async error => {\n  var _error$response;\n  const originalRequest = error.config;\n  if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401 && !originalRequest._retry) {\n    if (isRefreshing) {\n      // ðŸ”¥ If refresh already in progress â†’ wait\n      return new Promise(function (resolve, reject) {\n        failedQueue.push({\n          resolve,\n          reject\n        });\n      }).then(token => {\n        originalRequest.headers.Authorization = `Bearer ${token}`;\n        return axiosInstance(originalRequest);\n      }).catch(err => Promise.reject(err));\n    }\n    originalRequest._retry = true;\n    isRefreshing = true;\n    try {\n      const refreshToken = sessionStorage.getItem(\"refreshToken\");\n      const response = await axios.post(\"http://localhost:8080/api/auth/refresh\", {\n        refreshToken\n      });\n      const newAccessToken = response.data.accessToken;\n      sessionStorage.setItem(\"token\", newAccessToken);\n      processQueue(null, newAccessToken);\n      originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;\n      return axiosInstance(originalRequest);\n    } catch (refreshError) {\n      processQueue(refreshError, null);\n      sessionStorage.clear();\n      window.location.href = \"/login\";\n      return Promise.reject(refreshError);\n    } finally {\n      isRefreshing = false;\n    }\n  }\n  return Promise.reject(error);\n});\nexport default axiosInstance;","map":{"version":3,"names":["axios","axiosInstance","create","baseURL","headers","interceptors","request","use","config","token","sessionStorage","getItem","Authorization","error","Promise","reject","isRefreshing","failedQueue","processQueue","forEach","prom","resolve","response","_error$response","originalRequest","status","_retry","push","then","catch","err","refreshToken","post","newAccessToken","data","accessToken","setItem","refreshError","clear","window","location","href"],"sources":["/home/sakhaglobal/Projects/Spring-Boot/hotel-management-frontend/src/utils/axiosInstance.js"],"sourcesContent":["import axios from \"axios\";\n\nconst axiosInstance = axios.create({\n  baseURL: \"http://localhost:8080/api\",\n  headers: {\n    \"Content-Type\": \"application/json\",\n  },\n});\n\n// ðŸ”¹ Attach Access Token\naxiosInstance.interceptors.request.use(\n  (config) => {\n    const token = sessionStorage.getItem(\"token\");\n    if (token) {\n      config.headers.Authorization = `Bearer ${token}`;\n    }\n    return config;\n  },\n  (error) => Promise.reject(error)\n);\n\n// ðŸ”¥ Refresh Control Variables\nlet isRefreshing = false;\nlet failedQueue = [];\n\n// Process waiting requests\nconst processQueue = (error, token = null) => {\n  failedQueue.forEach((prom) => {\n    if (error) {\n      prom.reject(error);\n    } else {\n      prom.resolve(token);\n    }\n  });\n\n  failedQueue = [];\n};\n\n// ðŸ”¹ Response Interceptor\naxiosInstance.interceptors.response.use(\n  (response) => response,\n  async (error) => {\n    const originalRequest = error.config;\n\n    if (error.response?.status === 401 && !originalRequest._retry) {\n\n      if (isRefreshing) {\n        // ðŸ”¥ If refresh already in progress â†’ wait\n        return new Promise(function (resolve, reject) {\n          failedQueue.push({ resolve, reject });\n        })\n          .then((token) => {\n            originalRequest.headers.Authorization = `Bearer ${token}`;\n            return axiosInstance(originalRequest);\n          })\n          .catch((err) => Promise.reject(err));\n      }\n\n      originalRequest._retry = true;\n      isRefreshing = true;\n\n      try {\n        const refreshToken = sessionStorage.getItem(\"refreshToken\");\n\n        const response = await axios.post(\n          \"http://localhost:8080/api/auth/refresh\",\n          { refreshToken }\n        );\n\n        const newAccessToken = response.data.accessToken;\n\n        sessionStorage.setItem(\"token\", newAccessToken);\n\n        processQueue(null, newAccessToken);\n\n        originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;\n\n        return axiosInstance(originalRequest);\n\n      } catch (refreshError) {\n\n        processQueue(refreshError, null);\n\n        sessionStorage.clear();\n        window.location.href = \"/login\";\n\n        return Promise.reject(refreshError);\n      } finally {\n        isRefreshing = false;\n      }\n    }\n\n    return Promise.reject(error);\n  }\n);\n\nexport default axiosInstance;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}